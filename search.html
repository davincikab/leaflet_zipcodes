<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src='https://npmcdn.com/csv2geojson@latest/csv2geojson.js'></script>
    <link rel="stylesheet" href="search.css">
    </head>
    <body>
        <div class="container-fluid">
            <div class="search-section">
                <div class="input-group">
                    <input type="text" class="form-control" 
                        aria-label="Location" id="location-bar" placeholder="Search">
                </div>

                <div class="geolocate" id="geolocate">
                    <span><i class="fa fa-map-marker"></i></span>
                    <span>
                        Current Location
                    </span>
                </div>

                <div class="side-section" id="side-section">
                    <!-- <span>Results</span> -->
                </div>

                <div class="search-collapse-btn"></div>
            </div>


            <div class="direction">
                <!-- Current location -->
                <div class="input-tab">
                    <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text">
                              Desti
                          </span>
                        </div>
        
                        <input type="text" class="form-control" 
                            aria-label="Location" id="destination" placeholder="Destination ...">
                    </div>
                </div>
                <!--  -->
                <div id="instructions">

                </div>
            </div>

            <div class="map" id="map"></div>
            <div class="side-section" id="side-section">
                <!-- <span>Results</span> -->
            </div>
        </div>

    <script>
        var isMainPage = false;
        var geolocateButton = document.getElementById('geolocate');

        mapboxgl.accessToken = 'pk.eyJ1IjoiYmVubnl0cm92YXRvIiwiYSI6ImNrZDcwdTVwbTE4amEyem8yZWdkNHN3ZmoifQ.r3Llqtnwfqqju2zfzE-fvA';

        var map = new mapboxgl.Map({
            container: 'map',
            style:'mapbox://styles/mapbox/streets-v11', 
            center: [-96.6062800476281,  40.19020391149792],
            zoom: 3,
        });

        // create a mapbox control
        let navigation = new mapboxgl.NavigationControl();

        map.addControl(navigation, "bottom-right");

        // Add geolocate control to the map.
        var geoControl = new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
                },
                trackUserLocation: true
        });

        map.addControl(
            geoControl, 
            'top-right'
        );
    
    geolocateButton.addEventListener("click", function(e) {
        geoControl.trigger();
    });

     // Direcions
    function getDirections(type, start, stop) {
            var coordinates = start.toString() + ';' + stop.toString();
            var url = "https://api.mapbox.com/directions/v5/mapbox/"+type+"/-122.42,37.78;-77.03,38.91?access_token=" +mapboxgl.accessToken;
            
            var url =
            'https://api.mapbox.com/directions/v5/mapbox/'+type+'/' +
            coordinates
            '?steps=true&geometries=geojson&access_token=' +
            mapboxgl.accessToken;

            fetch(url)
            .then(res => res.json())
            .then(directions => {
                console.log(directions);

                var data = json.routes[0];
                var route = data.geometry.coordinates;
                var geojson = {
                    'type': 'Feature',
                    'properties': {},
                    'geometry': {
                    'type': 'LineString',
                    'coordinates': route
                    }
                };

            })
            .catch(error => {
                console.log(error);
            });
    }

    // add route
    function addRoute() {
               // if the route already exists on the map, we'll reset it using setData
               if (map.getSource('route')) {
                    map.getSource('route').setData(geojson);
                }
                // otherwise, we'll make a new request
                else {
                    map.addLayer({
                    'id': 'route',
                    'type': 'line',
                    'source': {
                        'type': 'geojson',
                        'data': {
                        'type': 'Feature',
                        'properties': {},
                        'geometry': {
                            'type': 'LineString',
                            'coordinates': geojson
                        }
                        }
                    },
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#3887be',
                        'line-width': 5,
                        'line-opacity': 0.75
                    }
                    });
                }
    }

    // add directions
    function addDirection(steps) {
        var instructions = document.getElementById('instructions');
          var steps = data.legs[0].steps;

          var tripInstructions = [];
          for (var i = 0; i < steps.length; i++) {
            tripInstructions.push('<br><li>' + steps[i].maneuver.instruction) +
              '</li>';
            instructions.innerHTML =
              '<br><span class="duration">Trip duration: ' +
              Math.floor(data.duration / 60) +
              ' min ðŸš´ </span>' +
              tripInstructions;
          }
    }
    // Bravabobby@gmail.com
    // Temp123!
    </script>
    <script src="search.js"></script>
</body>
</html>